<html>
<body>

<h1>Test Page</h1>

<b>Enter message to send.</b><br>
First line is name of remote function.<br>
The rest are arguments, one per line.<br>
<textarea id=vals cols=80 rows=4>
hello
foo
bar
</textarea>
<input id=sendbtn type=button value="Send"><p>

<b>This is what gets sent to the server</b><br>
<textarea id=msgsent cols=80 rows=2></textarea> <p>

<b>This is the response from the server</b><br>
<textarea id=msgrcvd cols=80 rows=2></textarea><p>



<script>

	var doc = document
	rpcURL = "http://localhost:50505/rpc/"

	function rpcReady() {
		var msgrcvd = doc.getElementById("msgrcvd")
		var msgsent = doc.getElementById("msgsent")
		var seq = 1;
		doc.getElementById('sendbtn').onclick = function() {
			var msg = document.getElementById('vals').value.split("\n")
			var line, i, m
			msgrcvd.value = ""
			msgsent.value = ""
			msgsent.value = JSON.stringify(msg)
			msg.push(function(rmsg) { msgrcvd.value = JSON.stringify(rmsg) })
			rpc.send.apply(rpc, msg)
		}
	}

	doc.body.onload = function() {
		var e = doc.createElement('script')
		e.id = "rpc"
		e.async = false
		e.src = rpcURL
		e.onload = rpcReady
		doc.body.appendChild(e)
	}

</script>

